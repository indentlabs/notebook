<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
  <div class="flex items-center mb-8">
    <%= link_to data_vault_path, class: 'text-gray-500 hover:text-gray-700 mr-3', title: "Back to your Data Vault" do %>
      <i class="material-icons">arrow_back</i>
    <% end %>
    <h1 class="text-3xl font-bold text-gray-700">Your year in review: <%= @year %></h1>
  </div>

  <% if current_user.created_at.year == @year %>
    <div class="bg-white rounded-lg shadow-md mb-12">
      <div class="p-6">
        <div class="flex items-start">
          <i class="material-icons text-orange-500 text-4xl mr-4">cake</i>
          <div>
            <h2 class="text-xl font-semibold text-gray-800 mb-2">
              You signed up to Notebook.ai on <%= current_user.created_at.strftime("%B %d of this year, a very fine %A") %>!
            </h2>
            <p class="text-gray-600">
              Thank you so much for finding and enjoying the site. It's been a pleasure to build over the years;
              I hope it's been as helpful for your worldbuilding as it has been for mine!
            </p>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <% if @earliest_page %>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-16">
      <div class="md:col-span-1">
        <div class="bg-white rounded-lg shadow-md p-6">
          <div class="flex items-start mb-4">
            <i class="material-icons <%= @earliest_page.class.text_color %> text-3xl mr-3">
              <%= @earliest_page.class.icon %>
            </i>
            <h2 class="text-xl font-semibold text-gray-800">
              It all started with <%= @earliest_page.name %>...
            </h2>
          </div>
          <p class="text-gray-600">
            The first notebook page you created this year was <%= @earliest_page.name %>,
            which you created on <%= @earliest_page.created_at.strftime("%B %d") %>. What a good omen for
            things to come!
          </p>
        </div>
      </div>
      
      <div class="md:col-span-2">
        <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-200">
          <div class="flex flex-col sm:flex-row">
            <div class="sm:w-1/3">
              <%= link_to @earliest_page do %>
                <%= image_tag @earliest_page.random_image_including_private, class: "w-full h-full object-cover" %>
              <% end %>
            </div>
            <div class="sm:w-2/3 p-6">
              <h3 class="text-xl font-semibold text-gray-800 mb-2"><%= @earliest_page.name %></h3>
              <p class="text-gray-600 mb-4">
                First created <%= time_ago_in_words @earliest_page.created_at %> ago
                and last updated <%= time_ago_in_words @earliest_page.updated_at %> ago.
              </p>
              <div class="mt-auto">
                <%= link_to "View #{@earliest_page.name}", @earliest_page, class: "#{@earliest_page.class.text_color} hover:underline font-medium" %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <% if @created_content['Universe'].any? %>
    <div class="mb-16">
      <%= render partial: 'content/components/parallax_header', locals: { content_type: 'Universe', content_class: Universe, image_only: true } %>
      
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex items-start">
          <i class="material-icons <%= Universe.text_color %> text-4xl mr-4"><%= Universe.icon %></i>
          <div>
            <h2 class="text-xl font-semibold text-gray-800 mb-2">
              You started creating <%= pluralize @created_content['Universe'].count, 'new universe' %> in <%= @year %>!
            </h2>
            <p class="text-gray-600">
              That's awesome!
              <% if @created_content['Universe'].count > 1 %>
                More than one is more than most! You must be great at multi-tasking!
              <% end %>
            </p>
          </div>
        </div>
      </div>
      
      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <% @created_content['Universe'].each do |universe| %>
          <%= link_to universe, class: "block group" do %>
            <div class="bg-<%= Universe.color %> text-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200">
              <div class="flex items-center">
                <i class="material-icons mr-2 group-hover:scale-110 transition-transform"><%= Universe.icon %></i>
                <span class="font-medium"><%= universe.name %></span>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if @total_created_non_universe_content > 0 %>
    <div class="mb-16">
      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex items-start mb-4">
          <i class="material-icons text-blue-600 text-4xl mr-4">dashboard</i>
          <div>
            <h2 class="text-xl font-semibold text-gray-800 mb-2">
              In your worlds, you created
              <%= pluralize @total_created_non_universe_content, 'notebook pages' %>
              this year!
            </h2>
            <p class="text-gray-600">
              That's a big deal! Fictitious worlds can be extremely hard and complex to create.
              Filling out worldbuilding pages is just the first step to make the world in your head a reality.
              The more you create and flesh out, the richer your world becomes!
            </p>
          </div>
        </div>
        
        <p class="text-gray-700 font-medium mb-4">In all, you created...</p>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6">
          <% Rails.application.config.content_types[:all_non_universe].each do |content_type| %>
            <% next if @created_content[content_type.name].count.zero? %>
            <div class="bg-<%= content_type.color %> rounded-lg shadow-md p-4 text-center">
              <div class="mb-2">
                <% icon_count = [@created_content[content_type.name].count, 4].min %>
                <% icon_count.times do %>
                  <i class="material-icons text-white inline-block mx-1">
                    <%= content_type.icon %>
                  </i>
                <% end %>
              </div>
              <div class="text-white font-medium">
                <%= pluralize @created_content[content_type.name].count, content_type.name %>
              </div>
            </div>
          <% end %>
        </div>
        
        <div class="text-right text-gray-700">
          <div class="flex items-center justify-end">
            <i class="material-icons mr-2">upload</i>
            <span>You also uploaded <%= pluralize @created_content['ImageUpload'].count, 'image' %> to your notebook pages this year!</span>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <% if @created_content['Document'].any? %>
    <div class="mb-16">
      <%= render partial: 'content/components/parallax_header', locals: { content_type: 'Document', content_class: Document, image_only: true } %>

      <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <div class="flex items-start">
          <i class="material-icons <%= Document.text_color %> text-4xl mr-4"><%= Document.icon %></i>
          <div>
            <h2 class="text-xl font-semibold text-gray-800 mb-2">
              You started writing <%= pluralize @created_content['Document'].count, 'document' %> in <%= @year %>!
            </h2>
            <p class="text-gray-600">
              Sometimes it can be hard to stare down that blank sheet... but you seem to be entirely unphased!
            </p>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <% @created_content['Document'].each do |document| %>
          <%= link_to document_path(document), class: "block group" do %>
            <div class="bg-<%= Document.color %> text-white rounded-lg shadow-md p-4 hover:shadow-lg transition-shadow duration-200">
              <div class="flex items-center">
                <i class="material-icons mr-2 group-hover:scale-110 transition-transform"><%= Document.icon %></i>
                <span class="font-medium truncate"><%= document.title %></span>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if @words_written > 0 %>
    <div class="mb-16">
      <div class="bg-blue-600 text-white rounded-lg shadow-md p-8 text-center">
        <h2 class="text-2xl font-bold mb-4">All in all, you wrote</h2>
        <div class="text-8xl font-bold mb-4"><%= number_with_delimiter @words_written %></div>
        <h2 class="text-2xl font-bold mb-2">words in Notebook.ai this year!</h2>
        <div class="text-blue-100">Good job!</div>
      </div>
    </div>
  <% end %>

  <% if @created_content['Thredded::Topic'].any? || @created_content['Thredded::Post'].any? || @created_content['ContentPageShare'].any? %>
    <div class="mb-16">
      <%= render partial: 'content/components/parallax_header', locals: { content_type: 'Discussion', content_class: Document, image_only: true } %>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div>
          <div class="bg-white rounded-lg shadow-md p-6 h-full">
            <div class="flex items-start mb-4">
              <i class="material-icons text-blue-600 text-3xl mr-3">forum</i>
              <h2 class="text-xl font-semibold text-gray-800">
                You're a social bee!
              </h2>
            </div>
            <p class="text-gray-600">
              You seem to strike a good balance between working alone and with others.
            </p>
          </div>
        </div>
        
        <div>
          <div class="bg-white rounded-lg shadow-md border-t-4 border-blue-500 p-6 text-center mb-6">
            <p class="text-gray-700 mb-2">This year, you created</p>
            <%= link_to thredded_path, class: "block" do %>
              <div class="text-5xl font-bold text-blue-600 mb-2"><%= @created_content['Thredded::Topic'].count %></div>
            <% end %>
            <p class="text-gray-700"><%= 'discussion topic'.pluralize @created_content['Thredded::Topic'].count %> on the forums.</p>
          </div>
          
          <div class="bg-white rounded-lg shadow-md border-t-4 border-<%= ContentPageShare.hex_color %> p-6 text-center">
            <p class="text-gray-700 mb-2">You shared your worldbuilding progress</p>
            <%= link_to stream_path, class: "block" do %>
              <div class="text-5xl font-bold <%= ContentPageShare.text_color %> mb-2"><%= @created_content['ContentPageShare'].count %></div>
            <% end %>
            <p class="text-gray-700"><%= 'time'.pluralize @created_content['ContentPageShare'].count %> with your followers.</p>
          </div>
        </div>
        
        <div>
          <div class="bg-white rounded-lg shadow-md border-t-4 border-blue-500 p-6 text-center h-full">
            <p class="text-gray-700 mb-2">and you replied to discussions</p>
            <%= link_to thredded_path, class: "block" do %>
              <div class="text-5xl font-bold text-blue-600 mb-2"><%= @created_content['Thredded::Post'].count %></div>
            <% end %>
            <p class="text-gray-700"><%= 'time'.pluralize @created_content['Thredded::Post'].count %>!</p>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <% if @created_content['PageCollection'].any? || @publish_rate > 0 %>
    <div class="mb-16">
      <%= render partial: 'content/components/parallax_header', locals: { content_type: 'PageCollection', content_class: PageCollection, image_only: true } %>
      
      <% if @created_content['PageCollection'].any? %>
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
          <div class="flex items-start">
            <i class="material-icons <%= PageCollection.text_color %> text-4xl mr-4"><%= PageCollection.icon %></i>
            <h2 class="text-xl font-semibold text-gray-800">
              You created <%= pluralize @created_content['PageCollection'].count, 'new Collection' %> in <%= @year %>!
            </h2>
          </div>
        </div>
        
        <div class="mb-12">
          <%= render partial: 'page_collections/collection_grid', locals: { collection_list: @created_content['PageCollection'], title: "Your #{@year} Collections" } %>
        </div>
      <% end %>

      <% if @publish_rate > 0 %>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div>
            <div class="bg-white rounded-lg shadow-md p-6">
              <div class="flex items-start mb-4">
                <i class="material-icons <%= PageCollection.text_color %> text-3xl mr-3">
                  <%= PageCollection.icon %>
                </i>
                <h2 class="text-xl font-semibold text-gray-800">
                  You were published in <%= pluralize @published_collections.count, 'Collection' %> this year!
                </h2>
              </div>
              <p class="text-gray-600 mb-2">
                You managed a <span class="font-bold"><%= (@publish_rate * 100 + 0.5).to_i %>%</span> acceptance rate when submitting to a Collection!
              </p>
              <p class="text-gray-600">
                Congratulations on being awesome!
              </p>
            </div>
          </div>
          
          <div class="lg:col-span-2">
            <%= render partial: 'page_collections/collection_grid', locals: { collection_list: @published_collections, title: "Collections highlighting #{current_user.display_name}'s work" } %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <div class="bg-white rounded-lg shadow-md p-6 mb-8">
    <div class="flex items-start mb-4">
      <i class="material-icons text-blue-600 text-4xl mr-4">date_range</i>
      <h2 class="text-xl font-semibold text-gray-800">
        <%= @year %> was a productive year for you!
      </h2>
    </div>
    <p class="text-gray-600 mb-4">
      Thanks for spending it on Notebook.ai. I can't wait to see what you accomplish in <%= @year + 1 %>! :)
    </p>
    <p class="text-right text-gray-700 italic">
      &mdash; Andrew
    </p>
  </div>
</div>