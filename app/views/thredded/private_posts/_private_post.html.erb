<% private_post, content = post_and_content if local_assigns.key?(:post_and_content) %>
<% is_current_user = private_post.user == current_user %>

<div id="<%= dom_id(private_post) %>" class="flex w-full <%= is_current_user ? 'justify-end' : 'justify-start' %> mb-4 group">
  <div class="flex max-w-[85%] md:max-w-[70%] <%= is_current_user ? 'flex-row-reverse' : 'flex-row' %> gap-2">
    
    <!-- Avatar -->
    <div class="flex-shrink-0 self-end mb-1">
      <% if private_post.user %>
        <%= image_tag private_post.user.image_url(size: 32), class: "w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700" %>
      <% else %>
        <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center text-xs font-bold text-gray-500">
          ??
        </div>
      <% end %>
    </div>

    <!-- Message Bubble -->
    <div class="flex flex-col <%= is_current_user ? 'items-end' : 'items-start' %>">
      <!-- Sender Name (only for others) -->
      <% unless is_current_user %>
        <span class="text-xs text-gray-500 dark:text-gray-400 ml-1 mb-1">
          <%= private_post.user&.thredded_display_name || 'Deleted User' %>
        </span>
      <% end %>

      <div class="px-4 py-2 rounded-2xl shadow-sm text-sm md:text-base break-words
                  <%= is_current_user ? 
                      'bg-blue-600 text-white rounded-br-none' : 
                      'bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border border-gray-200 dark:border-gray-700 rounded-bl-none' %>">
        <%= ForumReplacementService.replace_for(content, current_user) || render('thredded/private_posts/content', post: private_post) %>
      </div>
      
      <!-- Timestamp & Status -->
      <div class="flex items-center gap-1 mt-1 text-[10px] text-gray-400 dark:text-gray-500 <%= is_current_user ? 'mr-1' : 'ml-1' %>">
        <%= time_ago private_post.created_at %>
        <% if is_current_user && private_post.read_state == 'read' %>
          <i class="material-icons text-[12px] text-blue-500" title="Read">done_all</i>
        <% end %>
      </div>
    </div>
  </div>
</div>