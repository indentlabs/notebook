<%= form_for private_topic,
             url: private_topic.submit_path,
             html: {
                 class: "thredded--form thredded--new-private-topic-form #{local_assigns[:css_class]}",
                 'data-thredded-topic-form' => true,
                 'data-autocomplete-url' => autocomplete_users_path,
                 'data-autocomplete-min-length' => Thredded.autocomplete_min_length,
                 'data-thredded-submit-hotkey' => true,
             } do |form| %>

  <div class="space-y-4">
    <!-- Title Field -->
    <div>
      <%= form.label :title, t('thredded.private_topics.form.title_label'), class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
      <%= form.text_field :title,
                          placeholder: placeholder,
                          required: true,
                          autocomplete: 'off',
                          class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm" %>
      <%= render 'thredded/shared/field_errors', messages: form.object.errors[:title] %>
    </div>

    <!-- Participants Field -->
    <div>
      <%= form.label :user_names, t('thredded.private_topics.form.users_label'), class: "block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1" %>
      <%= form.text_area :user_names,
                         required: true,
                         placeholder: t('thredded.private_topics.form.users_placeholder'),
                         'data-thredded-users-select' => true,
                         'data-autocomplete-url' => autocomplete_users_path,
                         'data-autocomplete-min-length' => Thredded.autocomplete_min_length,
                         rows: 1,
                         class: "w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white text-sm" %>
      <p class="mt-1 text-xs text-gray-500 dark:text-gray-400 flex items-center">
        <i class="material-icons text-xs mr-1">info</i>
        Start typing to search for users
      </p>
      <%= render 'thredded/shared/field_errors', messages: form.object.errors[:user_names] %>
    </div>

    <!-- Message Content -->
    <%= render 'thredded/posts_common/form/content',
               form: form,
               content_label: t('thredded.private_topics.form.content_label'),
               preview_url: private_topic.preview_path %>

    <!-- Actions -->
    <div class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700">
      <a href="<%= private_topics_path %>" class="inline-flex items-center px-3 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors">
        <i class="material-icons text-sm mr-1">arrow_back</i>
        Cancel
      </a>

      <div class="flex items-center space-x-3">
        <button type="button" class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors" data-thredded-preview-toggle>
          <i class="material-icons text-sm mr-1">visibility</i>
          Preview
        </button>

        <button type="submit" class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors"
                data-disable-with="<%= t 'thredded.private_topics.form.create_btn_submitting' %>">
          <i class="material-icons text-sm mr-1">send</i>
          <%= t('thredded.private_topics.form.create_btn') %>
        </button>
      </div>
    </div>
  </div>
<% end %>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Handle preview toggle
  const previewBtn = document.querySelector('[data-thredded-preview-toggle]');
  const previewArea = document.querySelector('.thredded--preview-area');
  
  if (previewBtn && previewArea) {
    previewBtn.addEventListener('click', function() {
      previewArea.style.display = previewArea.style.display === 'none' ? 'block' : 'none';
      previewBtn.classList.toggle('active');
    });
  }
});
</script>