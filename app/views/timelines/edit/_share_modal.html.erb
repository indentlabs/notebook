<%# Share Modal Partial %>
<%# Locals: timeline %>

<!-- Share Modal -->
<div x-show="typeof showShareModal !== 'undefined' ? showShareModal : false"
     x-transition:enter="transition ease-out duration-200"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-150"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     class="fixed inset-0 z-50 overflow-y-auto"
     style="display: none;">
  <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <!-- Backdrop -->
    <div class="fixed inset-0 bg-gray-500 dark:bg-gray-900 bg-opacity-75 dark:bg-opacity-75 transition-opacity" @click="typeof showShareModal !== 'undefined' ? (showShareModal = false) : console.error('showShareModal not available')"></div>

    <!-- Modal -->
    <div class="inline-block align-bottom bg-white dark:bg-gray-800 rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full sm:p-6">
      <div class="sm:flex sm:items-start">
        <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-green-100 dark:bg-green-900 sm:mx-0 sm:h-10 sm:w-10">
          <i class="material-icons text-green-600 dark:text-green-400">share</i>
        </div>
        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left flex-1">
          <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-gray-100 mb-4">Share Timeline</h3>

          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">Shareable URL</label>
              <div class="flex rounded-lg shadow-sm">
                <input type="text"
                       readonly
                       value="<%= timeline_url(timeline) %>"
                       class="flex-1 min-w-0 block w-full px-3 py-2 rounded-none rounded-l-lg border border-gray-300 dark:border-gray-600 focus:ring-green-500 focus:border-green-500 sm:text-sm bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                       onclick="this.focus(); this.select();">
                <button type="button"
                        @click="navigator.clipboard.writeText('<%= timeline_url(timeline) %>'); $event.target.textContent = 'Copied!'; setTimeout(() => $event.target.textContent = 'Copy', 2000)"
                        class="inline-flex items-center px-3 py-2 border border-l-0 border-gray-300 dark:border-gray-600 rounded-r-lg bg-gray-50 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-sm hover:bg-gray-100 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                  Copy
                </button>
              </div>
            </div>

            <% if current_user && timeline.user == current_user %>
              <div class="bg-blue-50 dark:bg-blue-900 dark:bg-opacity-30 border border-blue-200 dark:border-blue-800 rounded-lg p-4 mb-4">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <i class="material-icons text-blue-400 dark:text-blue-300">info</i>
                  </div>
                  <div class="ml-3">
                    <h3 class="text-sm font-medium text-blue-800 dark:text-blue-200">Sharing Settings</h3>
                    <p class="mt-1 text-sm text-blue-700 dark:text-blue-300">
                      To be shared, content must either be public <strong>or</strong> in a public Universe.
                      <%= link_to 'Learn more about privacy', 'https://medium.com/indent-labs/privacy-on-notebook-ai-how-it-works-c23a59faeae2',
                          class: 'font-medium underline hover:text-blue-600 dark:hover:text-blue-400', target: '_blank' %>
                    </p>
                    <p class="mt-1 text-xs text-blue-600 dark:text-blue-400">
                      Changes are saved automatically and can be changed at any time.
                    </p>
                  </div>
                </div>
              </div>

              <!-- Privacy Toggle Controls -->
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <% if timeline.universe.present? %>
                  <!-- Universe Privacy Toggle -->
                  <div class="bg-purple-50 dark:bg-purple-900 dark:bg-opacity-30 border border-purple-200 dark:border-purple-800 rounded-lg p-4">
                    <div class="mb-3">
                      <h4 class="text-sm font-medium text-purple-900 dark:text-purple-200 flex items-center">
                        <i class="material-icons text-purple-600 dark:text-purple-400 text-sm mr-2">public</i>
                        Universe-wide sharing
                      </h4>
                      <p class="text-xs text-purple-700 dark:text-purple-300 mt-1">
                        Controls visibility for the entire "<%= timeline.universe.name %>" universe
                      </p>
                    </div>
                    <%=
                      react_component("PrivacyToggle", {
                        content:       timeline.universe.attributes.slice('id', 'name', 'page_type', 'privacy'),
                        content_icon:  Universe.icon,
                        content_color: Universe.color,
                        submit_path:   polymorphic_path(timeline.universe),
                        csrf_token:    form_authenticity_token
                      })
                    %>
                  </div>
                <% end %>

                <!-- Timeline Privacy Toggle -->
                <div class="<%= timeline.universe.present? ? '' : 'md:col-span-2' %> bg-green-50 dark:bg-green-900 dark:bg-opacity-30 border border-green-200 dark:border-green-800 rounded-lg p-4">
                  <div class="mb-3">
                    <h4 class="text-sm font-medium text-green-900 dark:text-green-200 flex items-center">
                      <i class="material-icons text-green-600 dark:text-green-400 text-sm mr-2">timeline</i>
                      Timeline-specific sharing
                    </h4>
                    <p class="text-xs text-green-700 dark:text-green-300 mt-1">
                      Controls visibility for this specific timeline
                    </p>
                  </div>
                  <%=
                    react_component("PrivacyToggle", {
                      content:       timeline.attributes.slice('id', 'name', 'page_type', 'privacy'),
                      content_icon:  Timeline.icon,
                      content_color: Timeline.color,
                      submit_path:   polymorphic_path(timeline),
                      csrf_token:    form_authenticity_token
                    })
                  %>
                </div>
              </div>

              <% if timeline.universe.present? %>
                <div class="mt-4 bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50 border border-gray-200 dark:border-gray-600 rounded-lg p-3">
                  <p class="text-xs text-gray-600 dark:text-gray-400">
                    <i class="material-icons text-gray-400 dark:text-gray-500 text-sm mr-1">info_outline</i>
                    This timeline belongs to the "<%= timeline.universe.name %>" universe.
                    Making the universe public will also make this timeline viewable to others.
                  </p>
                </div>
              <% end %>

              <!-- Social Sharing Buttons -->
              <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
                <a href="<%= [
                  'http://twitter.com/share?',
                  'url=' + CGI.escape(timeline_url(timeline)),
                  '&text=' + CGI.escape("Check out my timeline '#{timeline.name}' on Notebook.ai:")
                ].join %>"
                   target="_blank"
                   class="inline-flex items-center justify-center px-4 py-2 text-white rounded-lg text-sm font-medium transition-colors"
                   style="background: #1DA1F2;">
                  <i class="fa fa-twitter mr-2"></i>
                  Share on Twitter
                </a>
                <a href="https://www.facebook.com/sharer/sharer.php?u=<%= CGI.escape(timeline_url(timeline)) %>"
                   target="_blank"
                   onclick="return !window.open(this.href, 'Facebook', 'width=640,height=580')"
                   class="inline-flex items-center justify-center px-4 py-2 text-white rounded-lg text-sm font-medium transition-colors"
                   style="background: #4267B2;">
                  <i class="fa fa-facebook mr-2"></i>
                  Share on Facebook
                </a>
              </div>
            <% else %>
              <!-- Non-owner view -->
              <div class="bg-gray-50 dark:bg-gray-700 dark:bg-opacity-50 border border-gray-200 dark:border-gray-600 rounded-lg p-4">
                <p class="text-sm text-gray-700 dark:text-gray-300">
                  This timeline is being shared by <%= link_to timeline.user.name, timeline.user, class: "font-medium text-green-600 hover:text-green-500" %>.
                </p>
              </div>
            <% end %>
          </div>
        </div>
      </div>

      <div class="mt-5 sm:mt-4 sm:flex sm:flex-row-reverse">
        <button type="button"
                @click="typeof showShareModal !== 'undefined' ? (showShareModal = false) : console.error('showShareModal not available')"
                class="w-full inline-flex justify-center rounded-lg border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-gray-700 text-base font-medium text-gray-700 dark:text-gray-200 hover:text-gray-500 dark:hover:text-gray-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 sm:mt-0 sm:w-auto sm:text-sm">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
