<!-- Community Tab - Follow Relationships and Social Connections -->
<div class="space-y-8">
  
  <!-- Community Stats -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 p-6">
      <div class="flex items-center">
        <div class="p-3 bg-blue-100 rounded-lg">
          <i class="material-icons text-blue-600 text-2xl">people</i>
        </div>
        <div class="ml-4">
          <div class="text-2xl font-bold text-gray-900 dark:text-gray-100"><%= number_with_delimiter(@followers_count) %></div>
          <div class="text-sm text-gray-500 dark:text-gray-400">Followers</div>
        </div>
      </div>
    </div>
    
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 p-6">
      <div class="flex items-center">
        <div class="p-3 bg-green-100 rounded-lg">
          <i class="material-icons text-green-600 text-2xl">person_add</i>
        </div>
        <div class="ml-4">
          <div class="text-2xl font-bold text-gray-900 dark:text-gray-100"><%= number_with_delimiter(@following_count) %></div>
          <div class="text-sm text-gray-500 dark:text-gray-400">Following</div>
        </div>
      </div>
    </div>
    
    <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 p-6">
      <div class="flex items-center">
        <div class="p-3 bg-purple-100 rounded-lg">
          <i class="material-icons text-purple-600 text-2xl">connect_without_contact</i>
        </div>
        <div class="ml-4">
          <div class="text-2xl font-bold text-gray-900 dark:text-gray-100">
            <% mutual_count = user_signed_in? ? (@user.followed_users & current_user.followed_users).count : 0 %>
            <%= number_with_delimiter(mutual_count) %>
          </div>
          <div class="text-sm text-gray-500 dark:text-gray-400">Mutual connections</div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Followers Section -->
  <div>
    <div class="flex items-center justify-between mb-6">
      <div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 flex items-center">
          <i class="material-icons mr-3 text-blue-600 dark:text-blue-400 text-3xl">people</i>
          Followers
        </h2>
        <p class="text-gray-600 dark:text-gray-400 mt-1">
          People following <%= @user.name || @user.display_name %>
        </p>
      </div>
      
      <% if @followers_count > 12 %>
        <%= link_to followers_user_path(@user), class: "text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 font-medium" do %>
          View all <%= number_with_delimiter(@followers_count) %> followers →
        <% end %>
      <% end %>
    </div>
    
    <% if @followers.any? %>
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 p-6">
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
          <% @followers.each do |follower| %>
            <%= link_to follower, class: "group text-center" do %>
              <div class="relative">
                <%= image_tag follower.image_url(size: 80), class: "w-16 h-16 rounded-full border-2 border-gray-200 group-hover:border-blue-300 transition-colors duration-200 mx-auto" %>
                <% if follower.respond_to?(:online?) && follower.online? %>
                  <div class="absolute bottom-1 right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-white dark:border-slate-700"></div>
                <% end %>
              </div>
              <h3 class="text-sm font-medium text-gray-900 dark:text-gray-100 mt-2 truncate group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-200">
                <%= follower.name || follower.display_name %>
              </h3>
              <% if follower.username.present? %>
                <p class="text-xs text-gray-500 dark:text-gray-400 truncate">@<%= follower.username %></p>
              <% end %>
              
              <!-- Mutual connection indicator -->
              <% if user_signed_in? && current_user != @user && @current_user_following_ids.include?(follower.id) %>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 mt-1">
                  <i class="material-icons text-xs mr-1">connect_without_contact</i>
                  Mutual
                </span>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="text-center py-12 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700">
        <i class="material-icons text-gray-400 text-5xl mb-4">people_outline</i>
        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-2">
          <% if user_signed_in? && @user == current_user %>
            You don't have any followers yet
          <% else %>
            <%= @user.name || @user.display_name %> doesn't have any followers yet
          <% end %>
        </h3>
        <p class="text-gray-500 max-w-md mx-auto">
          <% if user_signed_in? && @user == current_user %>
            Share your content and engage with the community to attract followers who are interested in your work.
          <% else %>
            Be the first to follow <%= @user.name || @user.display_name %> and see their latest updates!
          <% end %>
        </p>
      </div>
    <% end %>
  </div>
  
  <!-- Following Section -->
  <div>
    <div class="flex items-center justify-between mb-6">
      <div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 flex items-center">
          <i class="material-icons mr-3 text-green-600 dark:text-green-400 text-3xl">person_add</i>
          Following
        </h2>
        <p class="text-gray-600 dark:text-gray-400 mt-1">
          People <%= @user.name || @user.display_name %> is following
        </p>
      </div>
      
      <% if @following_count > 12 %>
        <%= link_to following_user_path(@user), class: "text-sm text-green-600 dark:text-green-400 hover:text-green-700 dark:hover:text-green-300 font-medium" do %>
          View all <%= number_with_delimiter(@following_count) %> following →
        <% end %>
      <% end %>
    </div>
    
    <% if @following.any? %>
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 p-6">
        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4">
          <% @following.each do |followed_user| %>
            <%= link_to followed_user, class: "group text-center" do %>
              <div class="relative">
                <%= image_tag followed_user.image_url(size: 80), class: "w-16 h-16 rounded-full border-2 border-gray-200 group-hover:border-green-300 transition-colors duration-200 mx-auto" %>
                <% if followed_user.respond_to?(:online?) && followed_user.online? %>
                  <div class="absolute bottom-1 right-1 w-4 h-4 bg-green-400 rounded-full border-2 border-white dark:border-slate-700"></div>
                <% end %>
              </div>
              <h3 class="text-sm font-medium text-gray-900 dark:text-gray-100 mt-2 truncate group-hover:text-green-600 dark:group-hover:text-green-400 transition-colors duration-200">
                <%= followed_user.name || followed_user.display_name %>
              </h3>
              <% if followed_user.username.present? %>
                <p class="text-xs text-gray-500 dark:text-gray-400 truncate">@<%= followed_user.username %></p>
              <% end %>
              
              <!-- Mutual connection indicator -->
              <% if user_signed_in? && current_user != @user && @current_user_following_ids.include?(followed_user.id) %>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 mt-1">
                  <i class="material-icons text-xs mr-1">connect_without_contact</i>
                  Mutual
                </span>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% else %>
      <div class="text-center py-12 bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700">
        <i class="material-icons text-gray-400 text-5xl mb-4">person_add_disabled</i>
        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-2">
          <% if user_signed_in? && @user == current_user %>
            You're not following anyone yet
          <% else %>
            <%= @user.name || @user.display_name %> isn't following anyone yet
          <% end %>
        </h3>
        <p class="text-gray-500 max-w-md mx-auto">
          <% if user_signed_in? && @user == current_user %>
            Discover interesting creators in the community and follow them to stay updated with their latest content.
          <% else %>
            Following others helps build connections and discover new content in the community.
          <% end %>
        </p>
        
        <% if user_signed_in? && @user == current_user %>
          <div class="mt-6">
            <%= link_to users_path, class: "bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-medium transition-colors duration-200 inline-flex items-center" do %>
              <i class="material-icons mr-2 text-sm">explore</i>
              Discover Users
            <% end %>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>
  
  <!-- Recent Community Activity -->
  <% if @unified_activity.any? %>
    <div>
      <div class="flex items-center justify-between mb-6">
        <div>
          <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 flex items-center">
            <i class="material-icons mr-3 text-purple-600 dark:text-purple-400 text-3xl">group_work</i>
            Community Interactions
          </h2>
          <p class="text-gray-600 dark:text-gray-400 mt-1">
            Recent community engagement and interactions
          </p>
        </div>
        
        <button class="profile-tab text-sm text-purple-600 dark:text-purple-400 hover:text-purple-700 dark:hover:text-purple-300 font-medium" data-tab="activity">
          View all activity →
        </button>
      </div>
      
      <div class="bg-white dark:bg-slate-800 rounded-xl shadow-sm border border-gray-200 dark:border-slate-700 p-6">
        <div class="space-y-4">
          <% @unified_activity.select { |a| a[:type] == 'forum_post' || a[:type] == 'share' }.first(5).each do |activity| %>
            <div class="flex items-start space-x-3 pb-4 border-b border-gray-100 dark:border-slate-700 last:border-b-0 last:pb-0">
              <div class="flex-shrink-0 mt-1">
                <% case activity[:type] %>
                <% when 'share' %>
                  <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                    <i class="material-icons text-blue-600 text-sm">share</i>
                  </div>
                <% when 'forum_post' %>
                  <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">
                    <i class="material-icons text-purple-600 text-sm">forum</i>
                  </div>
                <% end %>
              </div>
              
              <div class="flex-1 min-w-0">
                <div class="text-sm text-gray-900 dark:text-gray-100">
                  <% case activity[:type] %>
                  <% when 'share' %>
                    Shared content with the community
                  <% when 'forum_post' %>
                    Participated in forum discussions
                  <% end %>
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                  <%= time_ago_in_words(activity[:created_at]) %> ago
                </div>
              </div>
            </div>
          <% end %>
          
          <% if @unified_activity.select { |a| a[:type] == 'forum_post' || a[:type] == 'share' }.empty? %>
            <div class="text-center py-8">
              <i class="material-icons text-gray-400 dark:text-gray-500 text-3xl mb-2">group_work</i>
              <p class="text-gray-500 dark:text-gray-400 text-sm">No recent community interactions</p>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>
  

</div>