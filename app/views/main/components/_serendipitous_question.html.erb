<% if @content && @attribute_field_to_question %>
  <style>
    /* Enhanced autosave visual feedback styles */
    .js-enhanced-autosave.border-yellow-400 {
      border-color: #fbbf24 !important;
      box-shadow: 0 0 0 1px #fbbf24 !important;
    }
    .js-enhanced-autosave.border-green-400 {
      border-color: #34d399 !important;
      box-shadow: 0 0 0 1px #34d399 !important;
    }
    .js-enhanced-autosave.border-red-400 {
      border-color: #f87171 !important;
      box-shadow: 0 0 0 1px #f87171 !important;
    }
    .js-enhanced-autosave:focus.border-yellow-400 {
      border-color: #fbbf24 !important;
      box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.2) !important;
    }
    .js-enhanced-autosave:focus.border-green-400 {
      border-color: #34d399 !important;
      box-shadow: 0 0 0 2px rgba(52, 211, 153, 0.2) !important;
    }
    .js-enhanced-autosave:focus.border-red-400 {
      border-color: #f87171 !important;
      box-shadow: 0 0 0 2px rgba(248, 113, 113, 0.2) !important;
    }
  </style>

  <div class="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden transform transition-all duration-300 hover:shadow-lg">
    <!-- Hero Image - Reduced height -->
    <div class="relative h-36 overflow-hidden">
      <%= image_tag @content.random_image_including_private(format: :original), class: 'w-full h-full object-cover' %>
      <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/30 to-transparent"></div>
      
      <!-- Content Type Badge -->
      <div class="absolute top-3 right-3">
        <div class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium <%= @content.color %> text-white backdrop-blur-sm shadow-sm">
          <i class="material-icons text-sm mr-1"><%= @content.icon %></i>
          <%= @content.page_type %>
        </div>
      </div>
      
      <!-- Content Title -->
      <div class="absolute bottom-3 left-4 right-4">
        <h3 class="text-lg font-bold text-white">
          <%= link_to @content.name, send("#{@content.page_type.downcase}_path", @content.id), class: "hover:text-blue-200 transition-colors" %>
        </h3>
        <% if @content.respond_to?(:universe) && @content.universe.present? %>
          <p class="text-xs text-gray-200">from <%= @content.universe.name %></p>
        <% end %>
      </div>
    </div>
    
    <%= form_for @content, url: FieldTypeService.form_path_from_attribute_field(@attribute_field_to_question), method: :patch, html: { class: "serendipitous-question-form" } do |f| %>
      <%= hidden_field(:override, :redirect_path, value: request.fullpath) %>
      <%= hidden_field_tag "entity[entity_id]", @content.id %>
      <%= hidden_field_tag "entity[entity_type]", @content.page_type %>
      <%= hidden_field_tag "field[name]", @attribute_field_to_question[:id] %>
      
      <!-- Question Content - More compact -->
      <div class="px-5 pt-4 pb-3">
        <h2 class="text-2xl font-bold text-gray-900 leading-tight">
          <%=
            t(
              "serendipitous_questions.attributes.#{@content.page_type.downcase}.#{@attribute_field_to_question.label.downcase}",
              name: @content.name,
              default: "What is #{@content.name}'s #{@attribute_field_to_question.label.downcase}?"
            )
          %>
        </h2>

        <div class="mt-2 flex items-center justify-between">
          <label class="text-xs text-gray-500 flex items-center">
            <span class="<%= @content.text_color %> font-medium"><%= link_to @content.name, @content.view_path %></span>
            <span class="mx-1">&rsaquo;</span>
            <span class="text-gray-600"><%= @attribute_field_to_question.label %></span>
          </label>
          <div class="js-autosave-status text-xs text-gray-400 hidden">
            <span class="js-status-text"></span>
          </div>
        </div>
      </div>
      
      <%
        field_value = @attribute_field_to_question.attribute_values.find_by(
          user: @content.user,
          entity_type: @content.page_type,
          entity_id: @content.id
        ).try(:value)
        
        placeholder = I18n.translate "attributes.#{@content.page_type.downcase}.#{@attribute_field_to_question.label.downcase.gsub(/\s/, '_')}",
          scope: :serendipitous_questions,
          name: @content.name || "this #{@content.page_type.downcase}",
          default: 'Write as little or as much as you want!'
      %>
      
      <!-- Text Area - No rounded top, full bleed -->
      <%=
        text_area_tag "field[value]",
                    field_value,
                    class: "w-full border-x-0 focus:border-notebook-blue h-40 border-gray-200 js-enhanced-autosave js-can-mention-pages resize-none transition-all duration-200 focus:ring-blue-500 focus:ring-opacity-50",
                    placeholder: placeholder
      %>
      
      <!-- Card Footer with Submit Button - Full bleed, more prominent -->
      <button type="submit" class="w-full px-5 py-4 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white transition-all duration-300 ease-out group cursor-pointer focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-inset hover:shadow-md active:scale-[0.998] active:shadow-inner">
        <div class="flex items-center justify-between">
          <span class="flex items-center font-medium">
            <svg class="w-5 h-5 mr-2 opacity-90 group-hover:opacity-100 group-hover:scale-110 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            Save answer & get next question
          </span>
          <svg class="w-5 h-5 opacity-80 group-hover:opacity-100 group-hover:translate-x-1 transition-all duration-300 ease-out" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </div>
        <div class="flex items-center text-xs text-blue-100 mt-1">
          <i class="material-icons text-xs mr-1 opacity-80 group-hover:opacity-100 transition-opacity duration-200"><%= @content.icon %></i>
          <span class="opacity-90 group-hover:opacity-100 transition-opacity duration-200">
            Your answer will be saved to your
            <span class="text-white font-medium"><%= @content.name %></span>
            <%= @content.page_type.downcase %> page
          </span>
        </div>
      </button>
    <% end %>
  </div>
<% end %>