<div class="row" style="margin-bottom: 0;">
  <!-- Privacy reminder notice -->
  <div class="col s12">
    <div class="card-panel blue lighten-5" style="border-left: 4px solid #2196F3; margin-bottom: 15px; padding: 12px 15px;">
      <div style="display: flex; align-items: center;">
        <i class="material-icons blue-text" style="margin-right: 8px;">info</i>
        <span>
          <small>
            <strong>Privacy Notice:</strong> All content on Notebook.ai is private by default. The content on this page has been explicitly made public by creators participating in Art Fight 2025.
          </small>
        </span>
      </div>
    </div>
  </div>
  <div class="col s12">
    <% 
      # Generate a consistent pattern for the background based on tag name
      pattern_seed = 5 # Fixed for ArtFight tag
      pattern_url = asset_path("card-headers/patterns/pattern#{pattern_seed}.png")
      
      # Calculate total items for the stats display
      total_items = @tagged_content.sum { |group| group[:content].count }
      content_types_count = @tagged_content.size
      creators_count = @tagged_content.flat_map { |group| group[:content].map(&:user_id) }.uniq.count
    %>
    
    <div class="card z-depth-1" style="border-radius: 4px; overflow: hidden;">
      <!-- Header with hero image background -->
      <div class="<%= @accent_color %>" style="position: relative; background: url('<%= pattern_url %>') center center; background-size: cover; height: 180px;">
        <!-- Dark overlay for better text contrast -->
        <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.3);"></div>
        
        <!-- Tag floating badge -->
        <div style="position: absolute; bottom: -24px; left: 24px; z-index: 2;">
          <div style="display: inline-block; background-color: white; padding: 14px 22px; border-radius: 4px; box-shadow: 0 2px 10px 0 rgba(0,0,0,0.2);">
            <div style="display: flex; align-items: center;">
              <i class="material-icons <%= @accent_color %>-text" style="font-size: 28px; margin-right: 12px;"><%= PageTag.icon %></i>
              <span style="font-size: 28px; font-weight: 500;" class="<%= @accent_color %>-text"><%= @tag %></span>
            </div>
          </div>
        </div>
        
        <!-- Art Fight 2025 header info -->
        <div style="position: absolute; top: 20px; left: 24px; z-index: 1;">
          <div>
            <span style="font-size: 24px; font-weight: 500; text-shadow: 0 1px 3px rgba(0,0,0,0.3); line-height: 1.2; display: block; color: white;">
              Art Fight 2025
            </span>
            <span style="font-size: 16px; text-shadow: 0 1px 2px rgba(0,0,0,0.3); display: block; color: white; margin-top: 4px;">
              Discover all public content tagged with ArtFight2025 across Notebook.ai
            </span>
          </div>
        </div>
      </div>
      
      <!-- Stats bar - clean and elegant -->
      <div class="<%= @accent_color %> lighten-5" style="padding: 30px 24px 16px 24px;">
        <div style="display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;">
          <!-- Left section (for title) -->
          <div style="margin-bottom: 10px;">
          &nbsp;
          </div>
          
          <!-- Right section (for stats) -->
          <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            <div class="chip z-depth-0 <%= @accent_color %> lighten-3" style="border: none; margin: 0;">
              <i class="material-icons left"><%= PageTag.icon %></i>
              <%= pluralize(total_items, 'item') %>
            </div>
            
            <div class="chip z-depth-0 <%= @accent_color %> lighten-3" style="border: none; margin: 0;">
              <i class="material-icons left">category</i>
              <%= pluralize(content_types_count, 'category') %>
            </div>
            
            <div class="chip z-depth-0 <%= @accent_color %> lighten-3" style="border: none; margin: 0;">
              <i class="material-icons left">people</i>
              <%= pluralize(creators_count, 'creator') %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col s12">
    <% if @tagged_content.empty? %>
      <div class="center-align" style="margin-top: 80px">
        <h5 class="grey-text">No public content with this tag</h5>
        <p class="grey-text">
          No one has created any public content with the "<%= @tag %>" tag yet.
        </p>
      </div>
    <% else %>
      <% @tagged_content.each do |content_group| %>
        <div class="section">
          <h5 class="<%= content_group[:color] %>-text">
            <i class="material-icons left"><%= content_group[:icon] %></i>
            <%= content_group[:type].pluralize %> (<%= content_group[:content].count %>)
          </h5>
          
          <div class="row js-content-cards-list">
            <% content_group[:content].each do |content| %>
              <div class="col s12 m6 l4 js-content-card-container">
                <div class="hoverable card sticky-action" style="margin-bottom: 2px">
                  <div class="card-image waves-effect waves-block waves-light">
                    <% 
                      # Find image for this content
                      content_image = @random_image_pool_cache.fetch([content.class.name, content.id], [])
                        .sample
                        .try(:src, :medium)

                      if @saved_basil_commissions
                        content_image ||= @saved_basil_commissions.fetch([content.class.name, content.id], [])
                          .sample
                          .try(:image)
                          .try(:url)
                      end

                      content_image ||= asset_path("card-headers/#{content.class.name.downcase.pluralize}.jpg")
                    %>
                    <div class="activator" style="height: 265px; background: url('<%= content_image %>'); background-size: cover;"></div>

                    <span class="card-title js-content-name activator">
                      <div class="bordered-text">
                        <% content_name = content.respond_to?(:name) ? content.name : content.title %>
                        <%= ContentFormatterService.show(text: content_name.presence || 'Untitled', viewing_user: current_user) %>
                      </div>
                      
                      <% if content.respond_to?(:page_tags) && content.page_tags.any? %>
                        <p class="tags-container">
                          <% content.page_tags.each do |tag| %>
                            <% if tag.tag == @tag %>
                              <span class="new badge <%= content_group[:color] %> left" data-badge-caption="<%= tag.tag %>"></span>
                            <% else %>
                              <span class="new badge grey left" data-badge-caption="<%= tag.tag %>"></span>
                            <% end %>
                          <% end %>
                        </p>
                      <% end %>
                    </span>
                  </div>
                  
                  <div class="card-action">
                    <% if content.is_a?(Document) %>
                      <%= link_to 'View', content, class: 'blue-text text-lighten-1', target: '_blank' %>
                    <% else %>
                      <%= link_to 'View', content, class: 'blue-text text-lighten-1' %>
                    <% end %>

                    <% user = @users_cache[content.user_id] %>
                    <% if user %>
                      <%= link_to profile_by_username_path(username: user.username), class: 'right grey-text' do %>
                        <% if user.image_url %>
                          <img src="<%= user.image_url.html_safe %>" alt="<%= user.display_name %>" style="width: 20px; height: 20px; border-radius: 50%; vertical-align: middle; margin-right: 5px;">
                        <% else %>
                          <i class="material-icons tiny" style="vertical-align: middle;">person</i>
                        <% end %>
                        <span style="vertical-align: middle; font-size: 0.9rem;"><%= user.display_name %></span>
                      <% end %>
                    <% end %>
                  </div>
                  
                  <div class="card-reveal">
                    <span class="card-title">
                      <%= content_name.presence || 'Untitled' %>
                      <i class="material-icons right">close</i>
                    </span>
                    <% content_description = content.try(:description) || content.try(:synopsis) %>
                    <% if content_description.present? %>
                      <p>
                        <%= sanitize ContentFormatterService.show(text: truncate(content_description, length: 420, escape: false), viewing_user: current_user) %>
                      </p>
                    <% end %>
                    
                    <% if content.respond_to?(:page_tags) && content.page_tags.any? %>
                      <p class="tags-container">
                        <% content.page_tags.each do |tag| %>
                          <% if tag.tag == @tag %>
                            <span class="new badge <%= content_group[:color] %> left" data-badge-caption="<%= tag.tag %>"></span>
                          <% else %>
                            <span class="new badge grey left" data-badge-caption="<%= tag.tag %>"></span>
                          <% end %>
                        <% end %>
                      </p>
                      <div class="clearfix"></div>
                    <% end %>
                    
                    <% user = @users_cache[content.user_id] %>
                    <% if user %>
                      <p>
                        <strong>Creator:</strong>
                        <%= link_to profile_by_username_path(username: user.username) do %>
                          <%= user.display_name %>
                        <% end %>
                      </p>
                    <% end %>
                    
                    <p class="grey-text clearfix">
                      <%= content.created_at == content.updated_at ? 'created' : 'last updated' %>
                      <%= time_ago_in_words content.updated_at %>
                      ago
                    </p>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</div>