<%# Books sidebar content - shared between desktop and mobile %>
<%# Requires: @document, @document_books, @user_books, and documentBooksSidebar() Alpine component %>

<div class="flex flex-col h-full overflow-hidden">
  <!-- Add to Book Section -->
  <div class="p-4 border-b border-gray-200 dark:border-gray-700">
    <h4 class="text-sm font-medium text-gray-700 dark:text-gray-200 mb-2">Add to a book</h4>

    <% available_books = @user_books.reject { |b| @document_books.include?(b) } %>
    <% if available_books.any? %>
      <div class="relative mb-3">
        <select
          x-model="selectedBookId"
          @change="addToBook()"
          class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 appearance-none cursor-pointer"
        >
          <option value="">Select a book...</option>
          <% available_books.each do |book| %>
            <option value="<%= book.id %>"><%= book.title %></option>
          <% end %>
        </select>
        <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
          <i class="material-icons text-gray-400 text-sm">expand_more</i>
        </div>
      </div>
    <% elsif @user_books.any? %>
      <p class="text-xs text-gray-500 dark:text-gray-400 mb-3">This document is in all your books</p>
    <% end %>

    <!-- Create new book button -->
    <button
      @click="createAndAddToBook()"
      :disabled="isCreatingBook"
      class="w-full flex items-center justify-center px-4 py-2 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 rounded-md transition-colors text-sm font-medium disabled:opacity-50"
    >
      <template x-if="!isCreatingBook">
        <span class="flex items-center">
          <i class="material-icons text-sm mr-2">add</i>
          Create New Book
        </span>
      </template>
      <template x-if="isCreatingBook">
        <span class="flex items-center">
          <i class="material-icons text-sm mr-2 animate-spin">refresh</i>
          Creating...
        </span>
      </template>
    </button>
  </div>

  <!-- Books List Section -->
  <div class="flex-1 overflow-y-auto">
    <% if @document_books.any? %>
      <div class="py-1">
        <%# Header removed - "Books" panel title already provides context %>
        <div class="divide-y divide-gray-200 dark:divide-gray-700" id="books-accordion">
          <% @document_books.each do |book| %>
            <%= render 'books/sidebar_book_section', book: book, document: @document %>
          <% end %>
        </div>
      </div>
    <% else %>
      <!-- Empty state -->
      <div class="flex flex-col items-center justify-center py-8 text-center px-4">
        <div class="w-12 h-12 rounded-full bg-gray-100 dark:bg-gray-700 flex items-center justify-center mb-3">
          <i class="material-icons text-gray-400 text-xl">menu_book</i>
        </div>
        <h4 class="text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Not in any books yet</h4>
        <p class="text-xs text-gray-500 dark:text-gray-400">Add this document to a book to organize your writing</p>
      </div>
    <% end %>
  </div>
</div>
