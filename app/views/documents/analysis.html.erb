<div class="min-h-screen">
  <% if @analysis.present? && @analysis.complete? %>
    <!-- Dashboard Header -->
    <div class="border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
          <div>
            <div class="flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mb-1">
              <%= link_to @document.title, @document, class: "hover:text-gray-700 dark:hover:text-gray-300" %>
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" />
              </svg>
              <span>Analysis</span>
            </div>
            <h1 class="text-2xl font-bold text-gray-900 dark:text-gray-100">Document Analysis</h1>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">
              by <%= link_to @document.user.display_name, @document.user, class: "text-gray-700 dark:text-gray-300 hover:underline" %>
              Â· Analyzed <%= time_ago_in_words(@analysis.completed_at) %> ago
            </p>
          </div>
          <div class="flex items-center gap-3">
            <%= link_to edit_document_path(@document), class: "inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-600 transition" do %>
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" />
              </svg>
              Edit Document
            <% end %>
            <%= link_to queue_analysis_document_path(@document), class: "inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-teal-600 hover:bg-teal-700 rounded-lg transition", data: { turbo_method: :post } do %>
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path d="M17.65,6.35C16.2,4.9 14.21,4 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20C15.73,20 18.84,17.45 19.73,14H17.65C16.83,16.33 14.61,18 12,18A6,6 0 0,1 6,12A6,6 0 0,1 12,6C13.66,6 15.14,6.69 16.22,7.78L13,11H20V4L17.65,6.35Z" />
              </svg>
              Re-analyze
            <% end %>
          </div>
        </div>
      </div>
    </div>

    <!-- Hero Stats Bar -->
    <div class="bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-5 gap-4">
          <!-- Words -->
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 text-center">
            <div class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100">
              <%= number_with_delimiter(@analysis.word_count || 0) %>
            </div>
            <div class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1">Words</div>
          </div>

          <!-- Reading Time -->
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 text-center">
            <% read_time = ((@analysis.word_count || 0) / 200.0).ceil %>
            <div class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100">
              <%= read_time %> <span class="text-lg">min</span>
            </div>
            <div class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1">Read Time</div>
          </div>

          <!-- Readability Score -->
          <%
            readability = @analysis.readability_score || 0
            readability_color = case readability
              when 66..100 then 'text-green-600 dark:text-green-400'
              when 36..65 then 'text-yellow-600 dark:text-yellow-400'
              else 'text-red-600 dark:text-red-400'
            end
          %>
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 text-center">
            <div class="text-2xl sm:text-3xl font-bold <%= readability_color %>">
              <%= readability %>
            </div>
            <div class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1">Readability</div>
          </div>

          <!-- Sentiment -->
          <%
            sentiment_label = @analysis.sentiment_label || 'neutral'
            sentiment_color = case sentiment_label.downcase
              when 'positive' then 'text-green-600 dark:text-green-400'
              when 'negative' then 'text-red-600 dark:text-red-400'
              else 'text-gray-600 dark:text-gray-400'
            end
            sentiment_icon = case sentiment_label.downcase
              when 'positive' then 'M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7,9.5C7,8.7 7.7,8 8.5,8C9.3,8 10,8.7 10,9.5C10,10.3 9.3,11 8.5,11C7.7,11 7,10.3 7,9.5M12,17.23C9.97,17.23 8.16,16.5 6.76,15.36L8.67,13.45C9.66,14.13 10.81,14.54 12,14.54C13.19,14.54 14.34,14.13 15.33,13.45L17.24,15.36C15.84,16.5 14.03,17.23 12,17.23M15.5,11C14.7,11 14,10.3 14,9.5C14,8.7 14.7,8 15.5,8C16.3,8 17,8.7 17,9.5C17,10.3 16.3,11 15.5,11Z'
              when 'negative' then 'M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7,9.5C7,8.7 7.7,8 8.5,8C9.3,8 10,8.7 10,9.5C10,10.3 9.3,11 8.5,11C7.7,11 7,10.3 7,9.5M12,14C9.67,14 7.69,15.46 6.89,17.5H17.11C16.31,15.46 14.33,14 12,14M15.5,11C14.7,11 14,10.3 14,9.5C14,8.7 14.7,8 15.5,8C16.3,8 17,8.7 17,9.5C17,10.3 16.3,11 15.5,11Z'
              else 'M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M7,9.5C7,8.7 7.7,8 8.5,8C9.3,8 10,8.7 10,9.5C10,10.3 9.3,11 8.5,11C7.7,11 7,10.3 7,9.5M15.5,11C14.7,11 14,10.3 14,9.5C14,8.7 14.7,8 15.5,8C16.3,8 17,8.7 17,9.5C17,10.3 16.3,11 15.5,11M12,17.5C10,17.5 8.23,16.5 7.15,15H16.85C15.77,16.5 14,17.5 12,17.5Z'
            end
          %>
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 text-center">
            <div class="flex items-center justify-center">
              <svg class="w-8 h-8 <%= sentiment_color %>" fill="currentColor" viewBox="0 0 24 24">
                <path d="<%= sentiment_icon %>" />
              </svg>
            </div>
            <div class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1 capitalize"><%= sentiment_label %></div>
          </div>

          <!-- Pages -->
          <div class="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 p-4 text-center">
            <div class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-gray-100">
              <%= @analysis.page_count || 0 %>
            </div>
            <div class="text-xs sm:text-sm text-gray-500 dark:text-gray-400 mt-1">Pages</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <%= render partial: 'documents/analysis/display', locals: { document: @document, analysis: @analysis } %>
    </div>

  <% elsif @analysis.present? %>
    <!-- Processing State -->
    <%= render partial: 'documents/analysis/processing', locals: { document: @document, analysis: @analysis } %>

  <% else %>
    <!-- No Analysis State -->
    <%= render partial: 'documents/analysis/no_analysis', locals: { document: @document } %>
  <% end %>
</div>
