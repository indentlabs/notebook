<!DOCTYPE html>
<html lang="en" class="<%= 'dark' if user_signed_in? && current_user.dark_mode_enabled? %>">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <%= csrf_meta_tags %>

  <%= stylesheet_link_tag 'application', media: 'all' %>
  <%= stylesheet_pack_tag 'application', media: 'all' %>
  <!--
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css" integrity="sha256-rByPlHULObEjJ6XQxW/flG2r+22R5dKiAoef+aXWfik=" crossorigin="anonymous" />
  -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">

  <%= render 'layouts/favicon' %>
  <%= javascript_include_tag 'application' %>
  <%= javascript_include_tag 'thredded' %>
  <%= javascript_pack_tag 'application' %>
  <%= render 'layouts/seo' %>
  <script defer type="text/javascript" src="https://js.stripe.com/v2/"></script>
  
  <!-- Simplified stylesheet and script section for debugging -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body data-in-app="true"
      class="<%= controller_name %> <%= action_name %> <%= 'dark' if user_signed_in? && current_user.dark_mode_enabled? %>"
      x-data="{ showSidebar: <%= user_signed_in? ? 'window.innerWidth >= 768' : 'false' %>, isDesktop: window.innerWidth >= 768 }"
>
  <%= render 'layouts/tailwind/navbar' %>

  <%= render 'layouts/tailwind/sidebar' %>

  <% unless content_for?(:messenger_fullscreen) %>
    <!-- forum navigation & breadcrumbs -->
    <nav class="thredded-nav bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between sticky top-14 z-40 overflow-hidden <%= user_signed_in? ? 'md:ml-56' : '' %> transition-all duration-300" <% if user_signed_in? %>:class="{ 'md:ml-56': showSidebar && isDesktop, 'md:ml-16': !showSidebar && isDesktop, 'ml-0': !isDesktop }"<% end %>>
      <ol role="list" class="flex-1 flex space-x-4 pl-12 pr-4 py-2 min-w-0 overflow-hidden">
        <%= render('thredded/redesigned/breadcrumbs') %>
      </ol>
      <ul class="flex items-center h-full divide-x divide-gray-200 dark:divide-gray-700">
        <li><!-- Included to always force a left-border on whatever action is left-most --></li>
        <%= render 'thredded/shared/nav/moderation' %>
        <%= render 'thredded/shared/nav/notification_preferences' %>
      </ul>
    </nav>
  <% end %>

  <!-- main content -->
  <main class="pt-14 <%= user_signed_in? ? 'md:ml-56' : '' %> transition-all duration-300" <% if user_signed_in? %>:class="{ 'md:ml-56': showSidebar && isDesktop, 'md:ml-16': !showSidebar && isDesktop, 'ml-0': !isDesktop }"<% end %>>
    <%= yield %>
  </main>

  <% unless content_for?(:messenger_fullscreen) %>
    <%= render 'layouts/footer' %>
  <% end %>

  <script type="text/javascript">
    <% if user_signed_in? %>
      DISABLE_KEYBOARD_SHORTCUTS = <%= !current_user.keyboard_shortcuts_preference %>;
    <% end %>

    document.addEventListener('DOMContentLoaded', function() {
      <%= yield :javascript %>
    });
  </script>

  <%= render 'layouts/ganalytics' %>
</body>
</html>