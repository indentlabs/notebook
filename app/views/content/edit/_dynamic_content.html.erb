<div id="dynamic-content" class="h-full overflow-y-auto">
  
  <!-- Details View (Form Fields) -->
  <div x-show="currentView === 'details'" class="py-8 px-4 sm:px-6 lg:px-14 max-w-5xl mx-auto">
    
    <!-- Show All Categories (Expanded View) -->
    <div x-show="expandAllCategories">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Edit All Details</h2>
        <p class="text-gray-600 dark:text-gray-400">Complete information for this <%= content.class_name.downcase %></p>
      </div>
      
      <%= render partial: 'content/edit/all_categories', locals: { content: content, raw_content: raw_content } %>
    </div>

    <!-- Single Category View -->
    <div x-show="!expandAllCategories && currentCategory">
      <% content.data[:categories].each do |category| %>
        <% next if category[:label] == 'Gallery' %>
        
        <div x-show="currentCategory === '<%= category[:label] %>'">
          <div class="mb-6">
            <div class="flex items-center mb-4">
              <div class="flex items-center">
                <i class="material-icons text-3xl <%= content.class_text_color %> mr-3"><%= category[:icon] %></i>
                <div>
                  <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Edit <%= category[:label] %></h2>
                  <p class="text-gray-600 dark:text-gray-400">Update <%= category[:label].downcase %> details for this <%= content.class_name.downcase %></p>
                </div>
              </div>
            </div>
            
            <!-- Progress indicator -->
            <% if category[:percent_complete].present? && category[:percent_complete] >= 25 %>
              <div class="bg-gray-200 rounded-full h-2 mb-4">
                <div class="<%= content.class_color %> text-xs text-white font-medium text-center leading-none rounded-full h-2" 
                     style="width: <%= category[:percent_complete] %>%">
                </div>
              </div>
              <p class="text-sm text-gray-600 dark:text-gray-400 mb-4"><%= category[:percent_complete] %>% complete</p>
            <% end %>
          </div>
          
          <%= render partial: 'content/edit/single_category', locals: { 
            content: content, 
            category: category,
            raw_content: raw_content 
          } %>
        </div>
      <% end %>
    </div>

    <!-- Default: Show first category -->
    <div x-show="!expandAllCategories && !currentCategory">
      <% first_category = content.data[:categories].find { |cat| cat[:label] != 'Gallery' } %>
      <% if first_category %>
        <div>
          <div class="mb-6">
            <div class="flex items-center mb-4">
              <div class="flex items-center">
                <i class="material-icons text-3xl <%= content.class_text_color %> mr-3"><%= first_category[:icon] %></i>
                <div>
                  <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Edit <%= first_category[:label] %></h2>
                  <p class="text-gray-600 dark:text-gray-400">Update <%= first_category[:label].downcase %> details for this <%= content.class_name.downcase %></p>
                </div>
              </div>
            </div>
          </div>
          
          <%= render partial: 'content/edit/single_category', locals: { 
            content: content, 
            category: first_category,
            raw_content: raw_content 
          } %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Gallery View -->
  <div x-show="currentView === 'gallery'" class="py-8 px-4 sm:px-6 lg:px-14 max-w-5xl mx-auto">
    <div class="mb-6">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">Gallery Management</h2>
          <p class="text-gray-600 dark:text-gray-400">Upload and manage images for this <%= content.class_name.downcase %></p>
        </div>
      </div>
    </div>
    
    <%= form_for raw_content, url: polymorphic_path(raw_content), method: :patch, html: { multipart: true } do |f| %>
      <%= render partial: 'content/edit/gallery_panel', locals: { 
        content: content, 
        raw_content: raw_content,
        f: f
      } %>
    <% end %>
  </div>

  <!-- Privacy View -->
  <div x-show="currentView === 'privacy'" class="py-6 px-4 sm:px-6 lg:px-14 max-w-5xl mx-auto">
    <div class="mb-4">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-1">Privacy & Sharing</h2>
      <p class="text-sm text-gray-600 dark:text-gray-400">Manage who can see and access this <%= content.class_name.downcase %></p>
    </div>
    
    <div x-data="{
      selectedPrivacy: '<%= raw_content.privacy || 'private' %>',
      publicType: 'standard',
      password: '',
      isLoading: false,
      showToast: false,
      toastMessage: '',
      isDark: document.documentElement.classList.contains('dark'),

      savePrivacySettings() {
        this.isLoading = true;
        
        const form = document.getElementById('privacy-settings-form');
        if (form) {
          const radioButton = form.querySelector('input[value=' + JSON.stringify(this.selectedPrivacy) + ']');
          if (radioButton) {
            radioButton.checked = true;
          }
          
          const formData = new FormData(form);
          
          fetch(form.action, {
            method: 'PATCH',
            body: formData,
            headers: {
              'X-CSRF-Token': document.querySelector('meta[name=csrf-token]').content,
              'X-Requested-With': 'XMLHttpRequest',
              'Accept': 'application/json'
            },
            credentials: 'same-origin'
          })
          .then(response => {
            if (response.ok) {
              // Update the main controller's privacy state
              window.dispatchEvent(new CustomEvent('privacy-updated', { 
                detail: { privacy: this.selectedPrivacy } 
              }));
              
              this.showToast = true;
              this.toastMessage = 'Privacy settings saved';
              setTimeout(() => {
                this.showToast = false;
              }, 3000);
            } else {
              this.showToast = true;
              this.toastMessage = 'Error saving privacy settings';
              setTimeout(() => {
                this.showToast = false;
              }, 3000);
            }
          })
          .catch(error => {
            console.error('Error:', error);
            this.showToast = true;
            this.toastMessage = 'Error saving privacy settings';
            setTimeout(() => {
              this.showToast = false;
            }, 3000);
          })
          .finally(() => {
            this.isLoading = false;
          });
        }
      }
    }" 
    x-init="
      $watch('selectedPrivacy', (value) => {
        savePrivacySettings();
      });
    "
    class="max-w-4xl mx-auto space-y-6">
      
      <!-- Toast Notification -->
      <div x-show="showToast"
           x-cloak
           x-transition:enter="transition ease-out duration-300"
           x-transition:enter-start="opacity-0 transform translate-y-2"
           x-transition:enter-end="opacity-100 transform translate-y-0"
           x-transition:leave="transition ease-in duration-200"
           x-transition:leave-start="opacity-100 transform translate-y-0"
           x-transition:leave-end="opacity-0 transform translate-y-2"
           class="fixed top-20 right-4 z-50 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center">
        <i class="material-icons text-sm mr-2">check_circle</i>
        <span x-text="toastMessage"></span>
      </div>
      
      <!-- Current Status Overview -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <div :class="selectedPrivacy === 'public'
                   ? (isDark ? 'bg-green-900/30' : 'bg-green-100')
                   : (isDark ? 'bg-gray-700' : 'bg-gray-100')"
                 class="w-8 h-8 rounded-lg flex items-center justify-center mr-3 transition-colors duration-200">
              <i :class="selectedPrivacy === 'public'
                   ? (isDark ? 'text-green-400' : 'text-green-600')
                   : (isDark ? 'text-gray-400' : 'text-gray-600')"
                 class="material-icons text-base transition-colors duration-200"
                 x-text="selectedPrivacy === 'public' ? 'public' : 'lock'">
              </i>
            </div>
            <div>
              <h3 class="text-sm font-semibold text-gray-900 dark:text-white flex items-center">
                Current Status
                <div x-show="isLoading" class="ml-2">
                  <svg class="animate-spin h-3 w-3 text-blue-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                  </svg>
                </div>
              </h3>
              <p class="text-xs text-gray-600 dark:text-gray-400">
                This <%= content.class_name.downcase %> is currently
                <span :class="selectedPrivacy === 'public'
                        ? (isDark ? 'text-green-400' : 'text-green-600')
                        : (isDark ? 'text-gray-400' : 'text-gray-600')"
                      class="font-medium transition-colors duration-200"
                      x-text="selectedPrivacy.charAt(0).toUpperCase() + selectedPrivacy.slice(1)">
                </span>
              </p>
            </div>
          </div>
          <div class="text-right">
            <div class="text-xs text-gray-500 dark:text-gray-400">Effective visibility</div>
            <% if raw_content.respond_to?(:universe) && raw_content.universe.present? && raw_content.universe.privacy == 'public' %>
              <div class="text-sm font-medium text-green-600 dark:text-green-300 flex items-center justify-end mt-0.5">
                <span>Public</span>
                <i class="material-icons text-xs ml-1 text-blue-500" title="Set by universe '<%= raw_content.universe.name %>'">info</i>
              </div>
              <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">via Universe</div>
            <% else %>
              <div :class="selectedPrivacy === 'public'
                     ? (isDark ? 'text-green-300' : 'text-green-600')
                     : (isDark ? 'text-gray-300' : 'text-gray-600')"
                   class="text-sm font-medium transition-colors duration-200 mt-0.5"
                   x-text="selectedPrivacy.charAt(0).toUpperCase() + selectedPrivacy.slice(1)">
              </div>
            <% end %>
          </div>
        </div>
      </div>
      
      <!-- Privacy Level Selection -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4">
        <div class="mb-4">
          <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1">Privacy Settings</h3>
          <p class="text-gray-600 dark:text-gray-400 text-xs">Choose who can see and access this <%= content.class_name.downcase %></p>
        </div>
        
        <%= form_for raw_content, remote: true, html: { id: "privacy-settings-form", class: "space-y-3" } do |f| %>
          <!-- Private Option -->
          <label class="group relative cursor-pointer block">
            <%= f.radio_button :privacy, 'private',
                class: 'sr-only',
                'x-model': 'selectedPrivacy' %>
            <div :class="selectedPrivacy === 'private'
                   ? (isDark ? 'border-blue-500 bg-blue-900/50 shadow-sm' : 'border-blue-500 bg-blue-50 shadow-sm')
                   : (isDark ? 'border-gray-700 hover:border-gray-600 hover:shadow-sm' : 'border-gray-200 hover:border-gray-300 hover:shadow-sm')"
                 class="border-2 rounded-lg p-3 transition-all duration-200">
              <div class="flex items-center">
                <div class="flex-shrink-0">
                  <div :class="selectedPrivacy === 'private'
                         ? 'bg-blue-500 text-white'
                         : (isDark ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-400')"
                       class="w-8 h-8 rounded-full flex items-center justify-center transition-all duration-200">
                    <i class="material-icons text-base">lock</i>
                  </div>
                </div>
                <div class="ml-3 flex-1">
                  <div class="text-sm font-semibold text-gray-900 dark:text-gray-100">Private</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400">Only you and collaborators can see this page</div>
                </div>
                <div class="flex-shrink-0 ml-3">
                  <div :class="selectedPrivacy === 'private' ? 'text-blue-500' : (isDark ? 'text-gray-600' : 'text-gray-300')"
                       class="transition-colors duration-200">
                    <i class="material-icons text-lg">check_circle</i>
                  </div>
                </div>
              </div>
            </div>
          </label>
          
          <!-- Public Option -->
          <label class="group relative cursor-pointer block">
            <%= f.radio_button :privacy, 'public',
                class: 'sr-only',
                'x-model': 'selectedPrivacy' %>
            <div :class="selectedPrivacy === 'public'
                   ? (isDark ? 'border-blue-500 bg-blue-900/50 shadow-sm' : 'border-blue-500 bg-blue-50 shadow-sm')
                   : (isDark ? 'border-gray-700 hover:border-gray-600 hover:shadow-sm' : 'border-gray-200 hover:border-gray-300 hover:shadow-sm')"
                 class="border-2 rounded-lg p-3 transition-all duration-200">
              <div class="flex items-center">
                <div class="flex-shrink-0">
                  <div :class="selectedPrivacy === 'public'
                         ? 'bg-blue-500 text-white'
                         : (isDark ? 'bg-gray-700 text-gray-300' : 'bg-gray-100 text-gray-400')"
                       class="w-8 h-8 rounded-full flex items-center justify-center transition-all duration-200">
                    <i class="material-icons text-base">public</i>
                  </div>
                </div>
                <div class="ml-3 flex-1">
                  <div class="text-sm font-semibold text-gray-900 dark:text-gray-100">Public</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400">Anyone with the link can view this page</div>
                </div>
                <div class="flex-shrink-0 ml-3">
                  <div :class="selectedPrivacy === 'public' ? 'text-blue-500' : (isDark ? 'text-gray-600' : 'text-gray-300')"
                       class="transition-colors duration-200">
                    <i class="material-icons text-lg">check_circle</i>
                  </div>
                </div>
              </div>
            </div>
          </label>
        <% end %>
        
        <!-- Additional Options for Private (Coming Soon) -->
        <div x-show="selectedPrivacy === 'private'"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform -translate-y-4"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             class="mt-4 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700">
          <h4 class="text-xs font-medium text-gray-900 dark:text-gray-100 mb-2 flex items-center">
            <i class="material-icons text-gray-600 dark:text-gray-400 text-sm mr-2">tune</i>
            Additional Options
          </h4>
          
          <div class="space-y-2">
            <!-- Password Protected -->
            <div class="flex items-center p-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 opacity-60">
              <div class="w-6 h-6 rounded-md bg-orange-100 dark:bg-orange-900/30 flex items-center justify-center mr-2 flex-shrink-0">
                <i class="material-icons text-xs text-orange-600 dark:text-orange-400">key</i>
              </div>
              <div class="flex-1 min-w-0">
                <div class="font-medium text-gray-900 dark:text-gray-100 text-xs">Password Protected</div>
                <div class="text-xs text-gray-600 dark:text-gray-400 truncate">Require a password to view when shared</div>
              </div>
              <span class="text-xs text-orange-600 dark:text-orange-400 px-1.5 py-0.5 bg-orange-100 dark:bg-orange-900/30 rounded font-medium ml-2 flex-shrink-0">Soon</span>
            </div>
          </div>
        </div>
        
        <!-- Additional Options for Public (Coming Soon) -->
        <div x-show="selectedPrivacy === 'public'"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform -translate-y-4"
             x-transition:enter-end="opacity-100 transform translate-y-0"
             class="mt-4 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700">
          <h4 class="text-xs font-medium text-gray-900 dark:text-gray-100 mb-2 flex items-center">
            <i class="material-icons text-gray-600 dark:text-gray-400 text-sm mr-2">tune</i>
            Additional Options
          </h4>

          <div class="space-y-2">
            <!-- Discoverable -->
            <div class="flex items-center p-2 bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 opacity-60">
              <div class="w-6 h-6 rounded-md bg-green-100 dark:bg-green-900/30 flex items-center justify-center mr-2 flex-shrink-0">
                <i class="material-icons text-xs text-green-600 dark:text-green-400">search</i>
              </div>
              <div class="flex-1 min-w-0">
                <div class="font-medium text-gray-900 dark:text-gray-100 text-xs">Discoverable</div>
                <div class="text-xs text-gray-600 dark:text-gray-400 truncate">Appears in public searches and content indexes</div>
              </div>
              <span class="text-xs text-orange-600 dark:text-orange-400 px-1.5 py-0.5 bg-orange-100 dark:bg-orange-900/30 rounded font-medium ml-2 flex-shrink-0">Soon</span>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Universe Privacy Section -->
      <% if raw_content.respond_to?(:universe) %>
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4" data-privacy-universe-section>
          <div class="mb-3">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1 flex items-center">
              <i class="material-icons text-sm <%= Universe.text_color %> mr-2"><%= Universe.icon %></i>
              Universe Privacy
            </h3>
            <% if raw_content.universe.present? %>
              <p class="text-xs text-gray-600 dark:text-gray-400">This page belongs to a universe with its own privacy settings</p>
            <% else %>
              <p class="text-xs text-gray-600 dark:text-gray-400">Organize your pages in a universe to manage privacy settings collectively</p>
            <% end %>
          </div>
          
          <div data-universe-content>
            <% if raw_content.universe.present? %>
              <!-- Current universe settings -->
              <div class="bg-gradient-to-br from-blue-50 to-indigo-50 dark:from-blue-900/50 dark:to-indigo-900/50 border border-blue-200 dark:border-blue-800 rounded-lg p-3">
              <div class="flex items-start">
                <div class="flex-shrink-0">
                  <div class="w-8 h-8 rounded-lg <%= Universe.color %> flex items-center justify-center">
                    <i class="material-icons text-white text-xs"><%= Universe.icon %></i>
                  </div>
                </div>
                <div class="ml-3 flex-1">
                  <div class="text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1"><%= raw_content.universe.name %></div>
                  <div class="flex items-center mb-1">
                    <span class="text-xs text-gray-600 dark:text-gray-400 mr-2">Universe is:</span>
                    <span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium <%= (raw_content.universe.privacy || 'private') == 'public' ? 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300' : 'bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300' %>">
                      <i class="material-icons text-xs mr-1"><%= (raw_content.universe.privacy || 'private') == 'public' ? 'public' : 'lock' %></i>
                      <%= (raw_content.universe.privacy || 'private').capitalize %>
                    </span>
                  </div>
                  
                  <% if (raw_content.universe.privacy || 'private') == 'public' %>
                    <div class="bg-blue-100 dark:bg-blue-900/30 border border-blue-200 dark:border-blue-800 rounded p-2">
                      <div class="flex items-start">
                        <i class="material-icons text-blue-600 dark:text-blue-300 text-sm mr-2 mt-0.5">bolt</i>
                        <div>
                          <div class="text-xs font-medium text-blue-900 dark:text-blue-100">Universe Override Active</div>
                          <div class="text-xs text-blue-700 dark:text-blue-300">All pages in this universe are automatically public</div>
                        </div>
                      </div>
                    </div>
                  <% else %>
                    <div class="text-xs text-gray-600 dark:text-gray-400">
                      Individual page privacy settings apply
                    </div>
                  <% end %>
                </div>
                <div class="ml-3 flex-shrink-0">
                  <%= link_to edit_polymorphic_path(raw_content.universe), 
                              class: "inline-flex items-center px-3 py-1.5 bg-white dark:bg-gray-700 border border-blue-300 dark:border-blue-600 rounded text-xs font-medium text-blue-700 dark:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-800 transition-colors" do %>
                    <i class="material-icons text-xs mr-1">settings</i>
                    Manage
                  <% end %>
                </div>
              </div>
            </div>
          <% else %>
            <!-- No universe - show feature promotion -->
            <div class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-3">
              <div class="flex items-start">
                <div class="flex-shrink-0">
                  <div class="w-8 h-8 rounded-lg bg-gray-200 dark:bg-gray-700 flex items-center justify-center">
                    <i class="material-icons text-gray-500 dark:text-gray-400 text-xs"><%= Universe.icon %></i>
                  </div>
                </div>
                <div class="ml-3 flex-1">
                  <div class="text-sm font-semibold text-gray-900 dark:text-gray-100 mb-1">No Universe Assigned</div>
                  <div class="text-xs text-gray-600 dark:text-gray-400 mb-2">
                    This <%= content.class_name.downcase %> isn't part of a universe yet.
                  </div>
                  <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded p-2 mb-2">
                    <div class="text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Benefits of using universes:</div>
                    <ul class="text-xs text-gray-600 dark:text-gray-400 space-y-1">
                      <li class="flex items-start">
                        <i class="material-icons text-xs text-blue-500 mr-1 mt-0.5">check_circle</i>
                        <span>Control privacy for all pages at once</span>
                      </li>
                      <li class="flex items-start">
                        <i class="material-icons text-xs text-blue-500 mr-1 mt-0.5">check_circle</i>
                        <span>Organize related content together</span>
                      </li>
                      <li class="flex items-start">
                        <i class="material-icons text-xs text-blue-500 mr-1 mt-0.5">check_circle</i>
                        <span>Share entire worlds with collaborators</span>
                      </li>
                    </ul>
                  </div>
                </div>
                <div class="ml-3 flex-shrink-0">
                  <button @click="switchView('details'); currentCategory = null; expandAllCategories = false; currentCategory = '<%= content.data[:categories].first[:label] rescue '' %>'" 
                          class="inline-flex items-center px-3 py-1.5 bg-blue-600 text-white border border-blue-600 rounded text-xs font-medium hover:bg-blue-700 transition-colors">
                    <i class="material-icons text-xs mr-1">add</i>
                    Assign Universe
                  </button>
                </div>
              </div>
            </div>
            <% end %>
          </div>
        </div>
      <% end %>
      
      <!-- Collaborators Section -->
      <% if raw_content.class.name == 'Universe' && raw_content.respond_to?(:contributors) %>
        <!-- For Universes, show a link to the Contributors tab instead -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-4">
          <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100 mb-3">Universe Contributors</h3>
          <p class="text-xs text-gray-600 dark:text-gray-400 mb-3">
            Manage who can collaborate on this universe and all its content
          </p>

          <% contributor_count = raw_content.contributors.count rescue 0 %>
          <div class="bg-purple-50 dark:bg-purple-900 border border-purple-200 dark:border-purple-800 rounded-lg p-3">
            <div class="flex items-start justify-between">
              <div>
                <div class="flex items-center mb-1">
                  <i class="material-icons text-sm text-purple-600 dark:text-purple-400 mr-2">group</i>
                  <span class="text-sm font-medium text-purple-900 dark:text-purple-100">
                    <%= contributor_count %> <%= 'contributor'.pluralize(contributor_count) %>
                  </span>
                </div>
                <p class="text-xs text-purple-800 dark:text-purple-200">
                  Contributors can edit all content within this universe
                </p>
              </div>
              <button @click="switchView('contributors')"
                      class="inline-flex items-center px-3 py-1.5 bg-purple-600 text-white border border-purple-600 rounded text-xs font-medium hover:bg-purple-700 transition-colors">
                <i class="material-icons text-xs mr-1">settings</i>
                Manage Contributors
              </button>
            </div>
          </div>
        </div>
      <% elsif raw_content.respond_to?(:contributors) %>
        <!-- For other content types that might have contributors in the future -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6">
          <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Collaborators</h3>
          <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Collaboration features coming soon</p>
        </div>
      <% end %>
      
      <!-- Auto-save indicator -->
      <div class="flex justify-center pt-4">
        <div class="text-sm text-gray-500 dark:text-gray-400 flex items-center">
          <i class="material-icons text-sm mr-2">info</i>
          Changes are saved automatically
        </div>
      </div>
      
    </div>
  </div>


  <!-- Contributors View (Universe only) -->
  <% if raw_content.class.name == 'Universe' %>
    <div x-show="currentView === 'contributors'" class="py-8 px-4 sm:px-6 lg:px-14 max-w-5xl mx-auto">
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2">Universe Contributors</h2>
        <p class="text-gray-600 dark:text-gray-400">Manage who can collaborate on this universe and all its content</p>
      </div>
      
      <%= render partial: 'content/shared/contributors_panel', locals: { 
        content: content, 
        raw_content: raw_content 
      } %>
    </div>
  <% end %>

  <!-- Settings View -->
  <div x-show="currentView === 'settings'" class="py-8 px-4 sm:px-6 lg:px-14 max-w-5xl mx-auto">
    <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-900 dark:text-gray-100 mb-2">Page Settings</h2>
      <p class="text-gray-600 dark:text-gray-400">Advanced settings for this <%= content.class_name.downcase %></p>
    </div>
    
    <div class="max-w-2xl space-y-6">
      <!-- Archive Section -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-6">
        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-4">Archive Page</h3>
        
        <div class="border border-yellow-300 dark:border-yellow-800 rounded-lg p-4 bg-yellow-50 dark:bg-yellow-900">
          <h4 class="text-sm font-medium text-yellow-800 dark:text-yellow-200 mb-2">Archive this <%= content.class_name.downcase %></h4>
          <p class="text-sm text-yellow-700 dark:text-yellow-300 mb-4">
            Archiving will hide this page from your main lists and searches. You can restore it anytime from your archives.
          </p>
          <div class="flex items-center space-x-3">
            <%= link_to polymorphic_path(raw_content), 
                        method: :delete,
                        data: { 
                          confirm: "Are you sure you want to archive #{raw_content.name}? You can restore it later from your archives.",
                          'soft-delete': true 
                        },
                        class: "inline-flex items-center px-4 py-2 border border-yellow-600 dark:border-yellow-500 text-sm font-medium rounded-md text-yellow-700 dark:text-yellow-300 bg-white dark:bg-gray-700 hover:bg-yellow-50 dark:hover:bg-yellow-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500" do %>
              <i class="material-icons text-sm mr-2">archive</i>
              Archive this page
            <% end %>
            
            <%= link_to recently_deleted_content_path, 
                        class: "inline-flex items-center px-4 py-2 text-sm font-medium text-yellow-700 dark:text-yellow-300 hover:text-yellow-800 dark:hover:text-yellow-200" do %>
              <i class="material-icons text-sm mr-1">restore</i>
              View archives
            <% end %>
          </div>
        </div>
      </div>
      
      <!-- Delete Section -->
      <div class="bg-white dark:bg-gray-800 rounded-lg shadow border border-gray-200 dark:border-gray-700 p-6">
        <h3 class="text-lg font-medium text-red-900 dark:text-red-100 mb-4">Danger Zone</h3>
        
        <div class="border border-red-300 dark:border-red-800 rounded-lg p-4 bg-red-50 dark:bg-red-900">
          <h4 class="text-sm font-medium text-red-800 dark:text-red-200 mb-2">Delete this <%= content.class_name.downcase %></h4>
          <p class="text-sm text-red-600 dark:text-red-300 mb-4">
            Once deleted, this page cannot be recovered. All associated data will be permanently removed.
          </p>
          <button type="button" 
                  onclick="confirmDelete('<%= raw_content.name %>', '<%= polymorphic_path(raw_content) %>')"
                  class="inline-flex items-center px-4 py-2 border border-red-600 dark:border-red-500 text-sm font-medium rounded-md text-red-600 dark:text-red-300 bg-white dark:bg-gray-700 hover:bg-red-50 dark:hover:bg-red-900 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
            <i class="material-icons text-sm mr-2">delete_forever</i>
            Delete this page
          </button>
        </div>
      </div>
    </div>
  </div>

</div>