<% show_submission_badge ||= false %>

<div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow duration-200 overflow-hidden">
  <%= link_to collection, class: "block" do %>
    <!-- Collection Header -->
    <div class="relative h-48 bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-700 dark:to-gray-600">
      <% if collection.header_image.attached? %>
        <%= image_tag collection.header_image, class: "w-full h-full object-cover" %>
      <% else %>
        <%= image_tag "card-headers/pagecollections.webp", class: "w-full h-full object-cover opacity-50" %>
      <% end %>
      
      <!-- Submission Badge -->
      <% if show_submission_badge %>
        <div class="absolute top-3 right-3">
          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200">
            <i class="material-icons text-xs mr-1">inbox</i>
            Accepting Submissions
          </span>
        </div>
      <% end %>
      
      <!-- Collection Stats -->
      <div class="absolute bottom-3 left-3">
        <div class="flex items-center space-x-2">
          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-black bg-opacity-50 text-white">
            <i class="material-icons text-xs mr-1">library_books</i>
            <% submissions_count = collection.respond_to?(:accepted_submissions) ? collection.accepted_submissions.count : 0 %>
            <%= pluralize submissions_count, 'page' %>
          </span>
          <% if collection.respond_to?(:allow_submissions?) && collection.allow_submissions? %>
            <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-500 bg-opacity-90 text-white">
              <i class="material-icons text-xs mr-1">group</i>
              Community
            </span>
          <% end %>
        </div>
      </div>
    </div>
    
    <!-- Collection Content -->
    <div class="p-6">
      <div class="flex items-start justify-between mb-3">
        <div class="flex-1 min-w-0">
          <h3 class="text-lg font-serif font-semibold text-gray-900 dark:text-white hover:text-blue-600 dark:hover:text-blue-400 transition-colors duration-200 line-clamp-1">
            <%= collection.title %>
          </h3>
          <% if collection.subtitle.present? %>
            <p class="text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-1">
              <%= collection.subtitle %>
            </p>
          <% end %>
        </div>
        <div class="ml-3 flex-shrink-0">
          <% privacy_status = collection.privacy || 'private' %>
          <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium <%= privacy_status == 'public' ? 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200' : 'bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300' %>">
            <i class="material-icons text-xs mr-1"><%= privacy_status == 'public' ? 'public' : 'lock' %></i>
            <%= privacy_status.capitalize %>
          </span>
        </div>
      </div>
      
      <!-- Description -->
      <% if collection.description.present? %>
        <p class="text-gray-700 dark:text-gray-300 text-sm mb-4 line-clamp-2">
          <%= truncate(CGI.unescapeHTML(strip_tags(collection.description.to_s)), length: 120) %>
        </p>
      <% end %>
      
      <!-- Content Types -->
      <% if collection.page_types&.any? %>
        <div class="flex flex-wrap gap-1 mb-4">
          <% collection.page_types.first(4).each do |type_name| %>
            <% content_class = content_class_from_name(type_name) rescue nil %>
            <% if content_class %>
              <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
                <i class="material-icons <%= content_class.text_color %> text-xs mr-1">
                  <%= content_class.icon %>
                </i>
                <%= type_name.pluralize %>
              </span>
            <% end %>
          <% end %>
          <% if collection.page_types.count > 4 %>
            <span class="inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300">
              +<%= collection.page_types.count - 4 %> more
            </span>
          <% end %>
        </div>
      <% end %>
      
      <!-- Footer -->
      <div class="flex items-center justify-between text-sm text-gray-500 dark:text-gray-400">
        <div class="flex items-center space-x-2">
          <% if collection.user.present? %>
            <%= image_tag collection.user.image_url(20), class: "w-5 h-5 rounded-full" %>
            <span><%= collection.user.display_name %></span>
          <% else %>
            <div class="w-5 h-5 rounded-full bg-gray-300 dark:bg-gray-600"></div>
            <span>Unknown User</span>
          <% end %>
        </div>
        <div class="flex items-center">
          <i class="material-icons text-xs mr-1">schedule</i>
          <span><%= time_ago_in_words(collection.updated_at || collection.created_at) %> ago</span>
        </div>
      </div>
    </div>
  <% end %>
</div>