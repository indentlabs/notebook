<div class="fixed z-50 inset-0 overflow-y-auto" id="edit-folder-modal">
  <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity" @click="showEditFolderModal = false"></div>
    <span class="hidden sm:inline-block sm:align-middle sm:h-screen">&#8203;</span>

    <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6">
      <%= form_for folder do |f| %>
        <div class="sm:flex sm:items-start">
          <div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 sm:mx-0 sm:h-10 sm:w-10">
            <i class="material-icons text-blue-600"><%= Folder.icon %></i>
          </div>
          <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
            <h3 class="text-lg leading-6 font-medium text-gray-900 mb-4">Edit folder</h3>
            <div class="mb-4">
              <label for="folder_title" class="block text-sm font-medium text-gray-700 mb-2">Folder name</label>
              <%= f.text_field :title, 
                  class: "w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500", 
                  id: "folder_title" %>
            </div>
            
            <div class="mb-4 relative" x-data="{ open: false, selectedId: '<%= folder.parent_folder_id || 'none' %>', selectedName: '<%= folder.parent_folder&.title || 'None' %>' }">
              <label for="folder_parent_folder_id" class="block text-sm font-medium text-gray-700 mb-2">Parent folder</label>

              <!-- Hidden input to store the actual value -->
              <%= f.hidden_field :parent_folder_id, "x-bind:value": "selectedId === 'none' ? '' : selectedId" %>

              <!-- Custom dropdown trigger -->
              <div
                @click="open = !open"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg text-left cursor-pointer bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 relative"
                :class="{ 'ring-2 ring-blue-500 border-blue-500': open }"
              >
                <span class="block truncate" x-text="selectedName"></span>
                <span class="absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none">
                  <i class="material-icons text-gray-400">expand_more</i>
                </span>
              </div>

              <!-- Dropdown menu -->
              <div
                x-show="open"
                @click.away="open = false"
                x-transition:enter="transition ease-out duration-100"
                x-transition:enter-start="transform opacity-0 scale-95"
                x-transition:enter-end="transform opacity-100 scale-100"
                x-transition:leave="transition ease-in duration-75"
                x-transition:leave-start="transform opacity-100 scale-100"
                x-transition:leave-end="transform opacity-0 scale-95"
                class="absolute z-[60] mt-1 w-full bg-white shadow-lg max-h-60 rounded-md py-1 text-base ring-1 ring-black ring-opacity-5 overflow-auto focus:outline-none sm:text-sm"
                style="display: none;"
              >
                <!-- None option -->
                <div
                  @click="selectedId = 'none'; selectedName = 'None'; open = false"
                  class="cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-100"
                  :class="{ 'bg-blue-100 text-blue-900': selectedId === 'none' }"
                >
                  <span class="block truncate">None</span>
                  <span x-show="selectedId === 'none'" class="absolute inset-y-0 right-0 flex items-center pr-4 text-blue-600">
                    <i class="material-icons text-sm">check</i>
                  </span>
                </div>
                
                <!-- Folder options -->
                <% current_user.folders.where.not(id: folder.id).each do |parent_folder| %>
                  <div
                    @click="selectedId = '<%= parent_folder.id %>'; selectedName = '<%= parent_folder.title %>'; open = false"
                    class="cursor-pointer select-none relative py-2 pl-3 pr-9 hover:bg-gray-100"
                    :class="{ 'bg-blue-100 text-blue-900': selectedId === '<%= parent_folder.id %>' }"
                  >
                    <span class="block truncate"><%= parent_folder.title %></span>
                    <span x-show="selectedId === '<%= parent_folder.id %>'" class="absolute inset-y-0 right-0 flex items-center pr-4 text-blue-600">
                      <i class="material-icons text-sm">check</i>
                    </span>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>
        
        
        <div class="mt-5 sm:mt-4 sm:flex sm:justify-between">
          <!-- Delete button on the left -->
          <div>
            <%
              if folder.parent_folder
                confirmation_text = "Are you sure you want to delete this folder?\n\n• All documents in this folder will be moved to \"#{folder.parent_folder.title}\"\n• All subfolders will be moved to \"#{folder.parent_folder.title}\"\n• The folder will be permanently deleted\n\nThis action cannot be undone."
                js_confirmation_text = "Are you sure you want to delete this folder?\\n\\n• All documents in this folder will be moved to \\\"#{folder.parent_folder.title}\\\"\\n• All subfolders will be moved to \\\"#{folder.parent_folder.title}\\\"\\n• The folder will be permanently deleted\\n\\nThis action cannot be undone."
              else
                confirmation_text = "Are you sure you want to delete this folder?\n\n• All documents in this folder will be moved to the root\n• All subfolders will be moved to the root\n• The folder will be permanently deleted\n\nThis action cannot be undone."
                js_confirmation_text = "Are you sure you want to delete this folder?\\n\\n• All documents in this folder will be moved to the root\\n• All subfolders will be moved to the root\\n• The folder will be permanently deleted\\n\\nThis action cannot be undone."
              end
            %>
            <%= button_to folder_path(folder), 
                method: :delete,
                form: { 
                  class: "inline-block",
                  data: { 
                    turbo_confirm: confirmation_text
                  },
                  onsubmit: "return confirm('#{js_confirmation_text}');"
                },
                class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-lg text-red-600 bg-red-50 hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" do %>
              <i class="material-icons mr-2 text-sm">delete</i>
              Delete Folder
            <% end %>
          </div>
          
          <!-- Save and Cancel buttons on the right -->
          <div class="flex flex-row-reverse">
            <%= f.submit 'Save changes', 
                class: "w-full inline-flex justify-center rounded-lg border border-transparent shadow-sm px-4 py-2 #{Folder.color} text-base font-medium text-white hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm" %>
            <button type="button"
                class="mt-3 w-full inline-flex justify-center rounded-lg border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:mr-3 sm:w-auto sm:text-sm"
                @click="showEditFolderModal = false">
              Cancel
            </button>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
